<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ì¶•í•˜ ë©”ì‹œì§€</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 840px; margin: 40px auto; padding: 0 16px; }
    header { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap: wrap; margin-bottom: 24px; }
    h1 { margin: 0; }
    .btn { padding: 10px 14px; border-radius: 10px; border: 1px solid #ddd; text-decoration: none; display:inline-block }
    .card { border:1px solid #eee; border-radius:16px; padding:16px; margin:12px 0; box-shadow: 0 2px 6px rgba(0,0,0,.04); }
    .meta { color:#666; font-size:12px; margin-bottom:8px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .empty { color:#777; padding: 24px; text-align:center; border:1px dashed #ddd; border-radius:12px; }
  </style>
</head>
<body>
  <header>
    <h1>ì¶•í•˜ ë©”ì‹œì§€ âœ¨</h1>
    <a id="newBtn" class="btn" target="_blank" rel="noopener">ë©”ì‹œì§€ ë‚¨ê¸°ê¸°(PR)</a>
  </header>

  <div id="list">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

  <script>
    // ì´ ë ˆí¬ì— ë§ì¶° ê³ ì •
    const OWNER  = 'ccccmkk';
    const REPO   = 'wedding-card';
    const BRANCH = 'main'; // ê¸°ë³¸ ë¸Œëœì¹˜ ì´ë¦„

    // â€œë©”ì‹œì§€ ë‚¨ê¸°ê¸°â€ ë²„íŠ¼: ìƒˆ íŒŒì¼(PR) ì‘ì„± í˜ì´ì§€ë¡œ ì´ë™
    const today = new Date().toISOString().slice(0,10); // YYYY-MM-DD
    const filename = `messages/${today}-your-name.md`;  // ì†ë‹˜ì´ your-nameì„ ë°”ê¾¸ê²Œ
    const template = [
      '# ì¶•í•˜ë©”ì‹œì§€',
      '',
      'ì—¬ê¸°ì— ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš” ğŸ‰',
      '',
      '> ì˜ˆ: í–‰ë³µí•˜ì„¸ìš”! - í™ê¸¸ë™'
    ].join('\n');
    const newUrl =
      `https://github.com/${OWNER}/${REPO}/new/${BRANCH}?` +
      `filename=${encodeURIComponent(filename)}` +
      `&value=${encodeURIComponent(template)}`;
    document.getElementById('newBtn').href = newUrl;

    // ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    const listEl = document.getElementById('list');

    async function fetchMessages() {
      try {
        const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/messages?ref=${BRANCH}`);
        if (res.status === 404) {
          listEl.innerHTML = '<div class="empty">ì•„ì§ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</div>';
          return;
        }
        if (!res.ok) throw new Error('list fetch failed');
        const files = (await res.json())
          .filter(f => f.type === 'file' && /\.md$/i.test(f.name))
          .sort((a,b)=> b.name.localeCompare(a.name)); // íŒŒì¼ëª… ê¸°ì¤€ ìµœì‹  ìš°ì„ 

        if (files.length === 0) {
          listEl.innerHTML = '<div class="empty">ì•„ì§ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</div>';
          return;
        }

        listEl.innerHTML = '';
        for (const f of files) {
          const raw = await fetch(f.download_url).then(r=>r.text()).catch(()=> '');
          const card = document.createElement('div');
          card.className = 'card';
          const meta = document.createElement('div');
          meta.className = 'meta';
          meta.textContent = f.name;
          const body = document.createElement('div');
          body.innerHTML = marked.parse(raw || '*ë‚´ìš© ì—†ìŒ*');
          card.appendChild(meta);
          card.appendChild(body);
          listEl.appendChild(card);
        }
      } catch (e) {
        console.error(e);
        listEl.textContent = 'ë©”ì‹œì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
      }
    }

    fetchMessages();
  </script>
</body>
</html>
